---
tag: [ "codenvy" ]
title: Workspace Automation
excerpt: "Automation for generating workspaces using URLs"
layout: docs
permalink: /:categories/workspace-automation/
---
{% include base.html %}


**Applies To**: Codenvy on-premises installs and codenvy.io hosted accounts.

---
A Factory is a template used to generate new or open existing workspaces with a URL. Factories can be used to create replicas of existing workspaces or to automate the provisioning of staticly or dynamically defined workspaces.

# Try a Factory
[Clone a public Codenvy workspace](http://codenvy.io/f?id=omriatu352kkthua) 

# Definitions

| Term   | Definition   
| --- | ---
| **Factory**   | A URL that, when clicked, generates a new or loads an existing workspace, and then onboards the user into that workspace.   
| **Factory Configuration**   | A JSON object that defines the rules and behavior for how the Factory should work.   
| **Workspace Configuration**   | A JSON object that defines the contents and structure of a workspace. A workspace configuration is used within a Factory Configuration to define the workspace to be generated.   
| **Owner**   | The user that authored a Factory. An owner can choose to have the resources consumed by workspaces generated from the Factory taken from the owner's account or the acceptor's.   
| **Acceptor**   | Any user that clicks on a Factory URL to open or generate a workspace. The acceptor is made a member or owner of the workspace depending upon the configuration.   
| **Named Workspace**   | A workspace bound to a user and is destroyed when a workspace administrator  destroys it.   
| **Temporary Workspace**   | A workspace that has a limited lifespan. Codenvy destroys temp workspaces when they are idle.   


# Using Factories
Factories can be invoked in mutliple ways. You can replace the `codenvy.io` domain with the hostname of any Codenvy on-premises installation.

| Approach   | Example   
| --- | ---
|  Invoke Factory using its unique hashcode <br>`/f?id={hashcode}` <br>`/factory?id={hascode}`| [https://codenvy.io/f?id=s38eam174ji42vty](https://codenvy.com/f?id=s38eam174ji42vty)
|  Invoke a named Factory <br> `/f?user={username}&name={factoryname}` <br>`/factory?user={username}&name={factoryname}`<br>`/factory/username/factoryname`  | [https://codenvy.io/f?user=tylerjewell&name=starwars](https://codenvy.com/f?user=tylerjewell&name=starwars)<br>[https://codenvy.io/factory?user=tylerjewell&name=starwars](https://codenvy.com/factory?user=tylerjewell&name=starwars)<br>[https://codenvy.io/factory/tylerjewell/starwars](https://codenvy.com/factory/tylerjewell/starwars)
|  Invoke Factory for a specific git repo <br>`/f?url={git URL}`  | [http://codenvy.io/f?url=https://github.com/eclipse/che](http://codenvy.io/f?url=https://github.com/eclipse/che)<br>[http://codenvy.io/f?url=https://github.com/eclipse/che/commits/language-server](http://codenvy.io/f?url=https://github.com/eclipse/che/commits/language-server)<br>[http://codenvy.io/f?url=https://gitlab.com/benoitf/simple-project](http://codenvy.io/f?url=https://gitlab.com/benoitf/simple-project)  
|  Use an embedded Factory to clone a workspace  <br>`/ws/{workspace}/{username}/clone`  | [https://codenvy.io/ws/eclipseche/tylerjewell/factory](https://codenvy.com/ws/eclipseche/tylerjewell/factory)   

Once the Factory is executed, it either loads an existing workspace or generates a new one, depending upon the Factory configuration.  The name of the workspace is determined within the Factory configuration and its name becomes part of the URL access.

| Generated Workspace   | Example   
| --- | ---
| Shorthand access to the workspace <br>`/ws/{workspace}` | [https://codenvy.io/ws/car](https://codenvy.com/ws/car)
| Fully qualified access to the workspace <br>`/ws/{workspace}/{username}` | [https://codenvy.io/ws/car/tylerjewell](https://codenvy.com/ws/car/tylerjewell)   
| 2nd workspace with same name generated by same user from same Factory <br><br>`/ws/{workspace}-1/{username}`  | [https://codenvy.io/ws/car-1/tylerjewell](https://codenvy.com/ws/car-1/tylerjewell)


# Creating Factories
You can create Factories that are saved with a unique hash code in the dashboard. Navigate to the `Factories` page and hit the `+` button in the top-right. You can create a Factory with a pretty name in the dashboard or by invoking a URL within your workspace.  If you generate a Factory template using your workspace URL, your Factory inherits the existing definition of your workspace.

| Create New Factory   | Example   
| --- | ---
| Create a new Factory with pretty name <br>`/ws/{workspace}/{user}/factory/{pretty}?save`   | [https://codenvy.io/ws/eclipseche/tylerjewell/factory/starwars?save](https://codenvy.com/ws/eclipseche/tylerjewell/factory/starwars?save)
| Create a new Factory from the dashboard <br>`Dashboard > Factories > Create` | [https://codenvy.io/f?id=s38eam174ji42vty](https://codenvy.com/f?id=s38eam174ji42vty)   
| Create on-demand URL Factory by specifying the remote URL In that case the configuration may be stored inside the repository. |[http://codenvy.io/f?url=https://github.com/eclipse/che](http://codenvy.io/f?url=https://github.com/eclipse/che)  [http://codenvy.io/f?url=https://github.com/eclipse/che](http://codenvy.io/f?url=https://github.com/eclipse/che)<br>[http://codenvy.io/f?url=https://github.com/eclipse/che/commits/language-server](http://codenvy.io/f?url=https://github.com/eclipse/che/commits/language-server)<br>[http://codenvy.io/f?url=https://gitlab.com/benoitf/simple-project](http://codenvy.io/f?url=https://gitlab.com/benoitf/simple-project)

You can also author a Factory from scratch using a `factory.json` file and then generating a Factory URL using our CLI or API.

# URL Factories  
URL Factories are working with github and gitlab repositories. By using URL Factories, the project referenced by the URL is imported.

URL can include a branch or a subfolder. Here is an example of url parameters:
- `?url=https://github.com/eclipse/che` che will be imported with master branch
- `?url=https://github.com/eclipse/che/tree/5.0.0` che is imported by using 5.0.0 branch
- `?url=https://github.com/eclipse/che/tree/5.0.0/dashboard` subfolder dashboard is imported by using 5.0.0 branch

## Customizing URL Factories
There are 2 ways of customizing the runtime and configuration

### Customizing only the runtime
Providing a `.codenvy.dockerfile` inside the repository will signal to the Codenvy URL Factory to use this dockerfile for the workspace agent runtime. By default imported projects are set to a `blank` project type, however project type can be set in the `codenvy.json` or workspace defintion that the Factory inherits from.

### Customizing the project and runtime
Providing a `.codenvy.json` file inside the repository will signal to the Codenvy URL Factory to configure the project and runtime according to this configuration file. When a `.codenvy.json` file is stored inside the repository, any `.codenvy.dockerfile` content is ignored as the workspace runtime configuration is defined inside the JSON file.

# Factory JSON Syntax
A Factory configuration is a JSON snippet either stored within Codenvy or as a `factory.json` file. You can create Factories within the IDE using our URL syntax, within the dashboard, or on the command line with the API and CLI.

```json  
factory : {
  v         : 4.0,            // Version of configuration format
  workspace : {},             // Identical to workspace:{} object for Eclipse Che
  policies  : {},             // (Optional) Restrictions that limit behaviors
  ide       : {},             // (Optional) Trigger IDE UI actions tied to workspace events
  creator   : {},             // (Optional) Identifying information of author
  button    : {}              // (Optional) Style dynamic button for Factory URL
}
```
The `factory.workspace` is identical to the `workspace:{}` object for Eclipse Che and contains the structure of the workspace. Learn more about [the workspace JSON object]().

Codenvy maintains object compatibility with the workspace definition from Eclipse Che. You can export Eclipse Che workspaces and then reuse the workspace definition within a Factory. Codenvy workspaces are composed of 0..n projects, 0..n environments which contain machine stacks to run the code, 0..n commands to perform against the code, and a type.

The `factory.policies`, `factory.ide`, `factory.creator`, and `factory.button` objects are unique to Factories. They provide meta information to the automation engine that alter the presentation of the Factory URL or the behavior of the provisioning.

## Mixins
A mixin adds additional behaviors to a project as a set of new project type attributes.  Mixins are reusable across any project type. You define the mixins to add to a project by specifying an array of strings, with each string containing the identifier for the mixin.  For example, `"mixins" : [ "tour", "pullrequest" ]`.

| Mixin ID   | Description   
| --- | ---
| `pullrequest`   | Enables pull request workflow where Codenvy handles local & remote branching, forking, and pull request issuance. Pull requests generated from within Codenvy have another Factory placed into the comments of pull requests that a PR reviewer can consume. Adds contribution panel to the IDE. If this mixin is set, then it uses attribute values for `project.attributes.local_branch` and `project.attributes.contribute_to_branch`.   
<br>
The `pullrequest` mixin requires additional configuration from the `attributes` object of the project.  If present, Codenvy will use the project attributes as defined in the Factory. If not provided, Codenvy will set defaults for the attributes.
<br>
Learn more about other mixins, on [`project : {}` object for Eclipse Che]()

## Pull Request Mixin Attributes
Project attributes alter the behavior of the IDE or workspace.

Different Eclipse Che and Codenvy plug-ins can add their own attributes to affect the behavior for the system.  Attribute configuration is always optional and if not provided within a Factory definition, the system will set itself.

| Attribute   | Description   
| --- | ---
| `local_branch` | Used in conjunction with the `pullrequest` mixin. If provided, the local branch for the project is set with this value. If not provided, then the local branch is set with the value of `project.source.parameters.branch` (the name of the branch from the remote).  If `local_branch` and `project.source.parameters.branch` are both not provided, then the local branch is set to the name of the checked out branch.   
| `contribute_to_branch` | Name of the branch that a pull request will be contributed to. Default is the value of `project.source.parameters.branch`, which is the name of the branch this project was cloned from.

<br>
 Here is a snippet that demonstrates full configuration of the contribution mixin.
```json  
factory.workspace.project : {
  "mixins"     : [ "pullrequest" ],

  "attributes" : {
    "local_branch"         : [ "timing" ],
    "contribute_to_branch" : [ "master" ]
  },

  "source" : {
    "type"       : "git\n    "location"   : "https://github.com/codenvy/che.git\n    "parameters" : {
      "keepVcs" : "true"
    }
  }
}
```


## factory.policies Object
Policies are a way to send instructions to the automation engine about the number of workspaces to create and their meta data such as lifespan, resource allocation, and chargeback location.

```json  
factory.policies : {
  type      : [named | temp],  // Default = named        
  location  : [acceptor |      // Default = acceptor. Where workspace lives
               owner],    
  resources : {},              // Resource grant for newly created workspace
  referer   : STRING,          // Works only for clients from referer
  since     : EPOCHTIME,       // Factory works only after this date
  until     : EPOCHTIME,       // Factory works only before this date
  create     : [perClick |      // Create one workpace per click, user or account
               perUser]     
}
```

```json  
factory.policies.resources : {
  ram : INTEGER                // RAM in MB for workspace default environment
}
```

### Longevity
`factory.policies.type` sets a newly created worskpace to be either named or temporary. A named workspace is given a persistent name and is only destroyed when a workspace administrator or owner destroys the workspace. It is essentially, persistent.  A temporary workspace will be destroyed by Codenvy based upon an internally configured policy. The default temporary workspace policy is that the workspace will be destroyed when idle for 10 minutes.  


### Location and Chargeback
`factory.policies.location` determines the user that will be charged the resources consumed by any workspace created by this Factory.  If `acceptor`, the person who clicks on the Factory will be charged for resource consumption in any chargeback model. If `owner` the person who authors the Factory will be charged for any resource consumption.

It is important to note that all workspaces are internally assigned to the user who clicked on the Factory that generated the workspace.  The workspace is not physically owned by the `owner`.  Codenvy just allocates the resource billing to the `owner`. The user that represents `owner` in this configuration can disable resources and effectively, disable the workspace for the user that originally clicked on the Factory.

### Authentication
Any user that clicks on a Factory URL must have a Codenvy account and be authenticated if the Factory configuration has `type : named` or `location : acceptor`. Both of these properties require Codenvy to understand either a permanent location or a user name in order to generate the workspace. Any user that is not authenticated will be presented a login screen after they click on the Factory URL.  Users without an account can create one using the same dialog.  

### Anonymous Factories
If a Factory is configured as `type : temp` and `location : owner`, then authentication is not required. Codenvy generates a temporary workspace and a temporary user.  This allows Factory authors to generate hack workspaces for temporary usage that simplify access for those people who do not want to take the time to create an account.

### Limitations
You can use `since : EPOCHTIME`, `until : EPOCHTIME` and `referer` as a way to prevent the Factory from executing under certain conditions.  `since` and `until` represent a valid time window that will allow the Factory to activate. For example, instructors who want to create an exercise that can only be accessed for two hours could set these properties.  The `referer` will check the hostname of the acceptor and only allow the Factory to execute if there is a match.

### Multiplicity
How many workspaces should be created?  If `count : perClick` then every click of the Factory URL will generate a different workspace, each with its own identifier, name and resources.  If `count : perUser`, then exactly one workspace will be generated for each unique user that clicks on the Factory URL. If the workspace has previously been generated, we will reopen the existing workspace and place the user into it.

## factory.ide Object
```json  
factory.ide.{event} : {        // {event}: onAppLoaded, onProjectsLoaded, onAppClosed
  actions : [{}]               // List of IDE actions to execute when event triggered
}

factory.ide.{event}.actions : [{
  id         : String,         // Action for IDE to perform when event triggered
  properties : {}              // Properties to customize action behavior
}]\
```
You can instruct the Factory to invoke a series of IDE actions based upon events in the lifecycle of the workspace.
* `onAppLoaded` - triggered when the IDE is loaded
* `onProjectsLoaded` - triggered when the workspace and all projects have been activated
* `onAppClosed` - triggered when the IDE is closed

This is an example that associates a variety of actions with all of the events.
```json  
"ide" : {  
  "onProjectsLoaded" : {            // Actions triggered when a project is opened
    "actions" : [{  
      "id" : "openFile\            // Opens a file in editor. Open addl files by repeating
      "properties" : {              // Specifies which file to open (include project name)
        "file" : "/my-project/pom.xml"
      }
    }, {  
      "id" : "findReplace\         // Find and replace values in source code
      "properties" : {  
        "in"          : "(pom\\.xm.*)|(test\\..*)\  // Which files?
        "find"        : "GROUP_ID\                  // What to replace?
        "replace"     : "Codenvy\                   // Replace with?
        "replaceMode" : "text_multipass"
      }
    }, {  
      "id" : "runCommand\          // Launch command after IDE opens
      "properties" : {    
        "name" : "MCI"
      }
    }
  ]},

  "onAppLoaded" : {                 // Actions to be triggered after IDE is loaded
    "actions" : [{  
      "id" : "openWelcomePage\     // Show a custom welcome panel and message
      "properties" : {  
        "authenticatedContentUrl"    : "http://media.npr.org/images/picture-show-flickr-promo.jpg\n        "authenticatedIconUrl"       : "https://codenvy.com/wp-content/uploads/2014/01/icon-android.png\n        "authenticatedTitle"         : "Welcome, John\n        "authenticatedNotification"  : "We are glad you are back!\n        "nonAuthenticatedContentUrl" : "http://media.npr.org/images/picture-show-flickr-promo.jpg\n        "nonAuthenticatedIconUrl"    : "https://codenvy.com/wp-content/uploads/2014/01/icon-android.png\n        "nonAuthenticatedTitle"      : "Welcome, Anonymous"
      }
    }
  ]},

  "onAppClosed" : {                 // Actions to be triggered when IDE is closed
    "actions" : [{  
      "id" : "warnOnClose\         // Show warning when closing browser tab
    }]
  }
}
```
Each event type has a set of actions that can be triggered. There is no ordering of actions executed when you provide a list; Codenvy will asynchronously invoke multiple actions if appropriate. Some actions can be configured in how they perform and will have an associated `properties : {}` object.

### onProjectsLoaded Event

| Action   | Properties?   | Description   
| --- | --- | ---
| `runCommand`   | Yes   | Specify the name of the command to invoke after the IDE is loaded. Specify the commands in the `factory.workspace.commands : []` array.   
| `openFile`   | Yes   | Open project files as a tab in the editor.   
| `findReplace`   | Yes   | Find and replace text in source files with regex.   

### onAppLoaded Event

| Action   | Properties?   | Description   
| --- | --- | ---
| `openWelcomePage`   | Yes   | Customize the content of the welcome panel when the workspace is loaded.   

### onAppClosed Event

| Action   | Properties?   | Description   
| --- | --- | ---
| `warnOnClose`   | No   | Opens a warning popup when the user closes the browser tab wtih a project that has uncommitted changes. Requires `project.parameters.keepVcs` to be `true`.   

#### Action: Open File
This action will open a file as a tab in the editor. You can provide this action multiple times to have multiple files open. The file property is a relative reference to a file in the project’s source tree. The `file` parameter is the relative path within the workspace to the file that should be opened by the editor. Note that projects are located in the workspaces `/projects` folder.
```json  
{  
  "id" : "openFile\n  "properties" : {  
    "file" : "/my-project/pom.xml"
  }
}
```
#### Action: Find / Replace Values After Project Cloning
If you create a project from a factory, you can have Codenvy perform a find / replace on values in the imported source code after it is imported into the project tree. This essentially lets you parameterize your source code.

Parameterizing source code allows you to create projects whose source code will be different for each click on the Factory. The most common use of this is inserting a developer-specific key into the source code. Each developer has their own key which is known to you. That key is inserted as the replacement variable and then inserted into the source code when that user invokes the Factory URL.

Parameterization works by replacing templated variables in the source code with values specified in the Factory object. The `findReplace` action is triggered by the `factory.ide.onProjectsLoaded : {}` event. It is an array of JSON objects, so you can perform multiple parameterizations on your source tree.
```json  
"onProjectOpened" : {                          
  "actions" : [{  
      "id" : "findReplace\            
      "properties" : {  
        "in"          : "(pom\\.xm.*)|(test\\..*)\  // Which files?
        "find"        : "GROUP_ID\                  // What to find?
        "replace"     : "Codenvy\                   // Replace with?
        "replaceMode" : "test_multipass"
      }
    }]
}
```
##### Regex Format
The `in` parameter specifies which files in the source tree to perform the find / replace function on. The value is a path format provided as a regular expression. Visit regex reference page for more details.

##### Replacement Mode
The `replaceMode` property indicates which replacement algorithm should be applied:
* `variable_singlepass`: Variables that start with ‘$’ and enclosed with curly brackets {} will be searched. For example, to replace variable `VAR_1_NAME` in the resulting code, put `${VAR_1_NAME}` variable in the source code. `${VAR_1_NAME}` will become `VAR_1_NAME`.
* `text_multipass`: Plain text will be searched. This is slower since all text must be searched.

It is possible to combine two replacement methods. Priority is given to singlepass. If no replacement method is specified, `variable_singlepass` mode will be used.

## factory.creator Object
This object has meta information that you can embed within the Factory. These attributes do not affect the automation behavior or the behavior of the generated workspace.
```json  
factory.creator : {
  name      : STRING,          // Name of author of this configuration file
  email     : STRING,          // Email address of author
  created   : EPOCHTIME,       // Set by the system
  userId    : STRING           // Set by the system
}\
```
## factory.button Object
```json  
# Defines a visual button or logo that can front the Factory URL
factory.button : {
  type       : [logo |         // Sets whether button contains user's logo
                nologo],
  attributes : {}              // Properties of the button
}

factory.button.attributes : {
  color   : [gray | white],    // Background color. Ignored if type = logo
  counter : [false | true],    // Adds counter for clicks, updated daily
  logo    : URL,               // Button image URL. Ignored if type = nologo
  style   : [horizontal |      // Counter direction. Ignored if type = logo
             vertical]      
}\
```
We provide three button types with animations that execute when you hover over them.  You can save the button configuration with the Factory by filling in the `factory.button` object with the Factory configuration.  You can also use our button formats directly within Markdown and HTML using a JavaScript snippet.

We have three types of buttons.

| Button Type   | Sample   
| --- | ---
| White: 76 x 20 pixels  | [![alt](https://codenvy.io/factory/resources/factory-white.png)]()
| Dark: 76 x 20 pixels  | [![alt](https://codenvy.io/factory/resources/factory-dark.png)]()
| Logo: 104 x 104 image of your logo with our hover animation layered on top  | [![alt](https://files.readme.io/zolQfjkhT4KKn3P1xBdc_logo.PNG)]()   


#### Button Animation
Button animations do not work withing Markdown documents, unfortunately.  Our docs are built using a Markdown editor, so these samples will not give you the hover animation.  

### JavaScript Button: Configuration From Factory
You can save your button configuration within Codenvy when you generate the Factory configuration. You do this by filling in the `factory.button` fields as part of your `factory.json`. Your button configuration is saved within Codenvy and any logo image is uploaded and hosted on our servers. You can then reference this Factory button directly using JavaScript.
```html  
<script
    type="text/javascript"
    src="https://codenvy.com/factory/resources/factory.js?FACTORY_HASH_CODE"
        >
</script>
```
### JavaScript Button: Configuration Within JavaScript
You can reuse our buttons and animations without first having created a Factory.  
```html  
<script
    type    = "text/javascript"
    src     = "https://codenvy.com/factory/resources/factory.js"
    style   = ["gray" | "white" | "advanced"]
    counter = ["horizontal" | "vertical"]
    url     = URL_TO_ACTIVATE_WHEN_BUTTON_CLICKED
    logo    = URL_TO_YOUR_LOGO
        >
</script>
```
The `gray` style will cause the small dark animation button to load. The `white` does the small white animation button to load. Use `advanced` if you want to have your logo image loaded with our hover animation on top of it.  The `counter` will add a click counter to the button that is updated daily with the counts stored server side. The `style` attribute can be `white`, `dark` or `advanced`, which displays your logo.

### Markdown Button
```markdown  
[![alt](https://codenvy.com/factory/resources/factory-white.png)](URL)
[![alt](https://codenvy.com/factory/resources/factory-dark.png)](URL)\
```
### Button Examples
```html  
<script
    type    = "text/javascript"
    src     = "https://codenvy.com/factory/resources/factory.js"
    style   = "advanced"
    counter = "horizontal"
    url     = "https://codenvy.com"
    logo    = "http://bit.ly/1CjqxdR"
        >
</script>
```

```markdown  
[![alt](https://codenvy.com/factory/resources/factory-white.png)](https://codenvy.io/f?id=s38eam174ji42vty)\
```
